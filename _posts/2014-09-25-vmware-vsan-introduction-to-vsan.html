---
layout: post
title: 'VMware VSAN: I/O'
date: '2014-09-25T01:24:00.001-07:00'
author: Girish Rao
tags:
- misc
- VSAN
modified_time: '2014-10-11T23:55:52.596-07:00'
thumbnail: http://lh4.ggpht.com/-5hdXO092WGs/VCPVY4_RbpI/AAAAAAAACZQ/GUwQFzMlQ38/s72-c/image_thumb%25255B4%25255D.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-984868599755994151.post-8596797835933021069
blogger_orig_url: http://www.virtualtipsntricks.com/2014/09/vmware-vsan-introduction-to-vsan.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><br />Let’s see how I/O is performed on a distributed object in VSAN.  <br />Let’s look at the write operations first. <br />When the Guest OS performs a write to a virtual SCSI disk, that write goes to the local VSAN module on that host and from there it is sent concurrently to all the replicas of that .vmdk. The write operation is persisted on the flash(SSD) that fronts the disk of each replica and only after that it is acknowledged back to the VM. All data from the moment a write operation completes have the required degree of replication per specified policy. <br />Later and asynchronously, VSAN de-stages the written data to the magnetic disk. This may take seconds or even many minutes depending on the circumstances. A certain logical block of a .vmdk may be overwritten multiple times on the Flash, but only the latest copy will be finally de-staged. Also, VSAN de-stages data in batches that are going to the same physical proximity on the HDD, so that we essentially get sequential performance out of the HDD. <br /><a href="http://lh5.ggpht.com/-fs84AygyHYk/VCPVXkD_mwI/AAAAAAAACZI/EURsyPwUb_M/s1600-h/image%25255B8%25255D.png"><img alt="image" border="0" src="http://lh4.ggpht.com/-5hdXO092WGs/VCPVY4_RbpI/AAAAAAAACZQ/GUwQFzMlQ38/image_thumb%25255B4%25255D.png?imgmax=800" height="257" style="border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: block; float: none; margin-left: auto; margin-right: auto;" title="image" width="412" /></a>  <br />And now lets look at the read operations. <br />When a read operation is issued from the Guest OS, it again goes through the local VSAN module. VSAN decides which replica to read the data from and if it is remote, it sends it to that node. In the vast majority of the cases, the read will be satisfied from the Flash (when the blocks are part of the active data set of the .vmdk that is cached in the Flash). If it is not there, then it is fetched from the HDD and placed in the Read Cache in the Flash for future accesses. <br />VSAN is intelligent in how it forwards reads to replicas. First it load balances across them, but it also makes sure that reads for certain ranges of logical .vmdk addresses go always to the same replica. This way, we never have the same block cached in more than one place and therefore we make a much better use of Flash capacity. <br /><a href="http://lh6.ggpht.com/-4FLzGCz4AHE/VCPVaS7VKdI/AAAAAAAACZY/8JnjpvDEwXg/s1600-h/image%25255B13%25255D.png"><img alt="image" border="0" src="http://lh4.ggpht.com/-hHXNsDA8YUQ/VCPVbp66vHI/AAAAAAAACZg/pX8d0Dsqtlg/image_thumb%25255B7%25255D.png?imgmax=800" height="232" style="border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: block; float: none; margin-left: auto; margin-right: auto;" title="image" width="407" /></a>  <br /><br /><br /><br /><br /><br /><br /><br /></div>