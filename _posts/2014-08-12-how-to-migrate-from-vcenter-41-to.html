---
layout: post
title: How to migrate from VCenter 4.1 to VCenter 5.5
date: '2014-08-12T21:55:00.000-07:00'
author: Girish Rao
tags:
- vcenter
modified_time: '2014-10-11T23:49:14.089-07:00'
blogger_id: tag:blogger.com,1999:blog-984868599755994151.post-7052705888366831769
blogger_orig_url: http://www.virtualtipsntricks.com/2014/08/how-to-migrate-from-vcenter-41-to.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;"><em style="background-color: white; border: 0px; line-height: 18px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><br />1. Install a 64-bit Windows OS on a new vCenter server. Lets call this new server "vc5" and let's call the current vCenter 4.1 server "vc4". Make sure that the hostname/ip address of vc5 is properly registered in DNS - forward and reverse pointer records created and work successfully.</em></div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;"><em style="background-color: white; border: 0px; line-height: 18px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">2. On vc4, use SQL Management Studio Express to take a backup of the vCenter database. It is desirable to shutdown the vCenter services beforehand and keep them disabled.</em></div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;"><em style="background-color: white; border: 0px; line-height: 18px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">3. Install the SQL-2008-R2-Express software from the "redist" folder on the vCenter 5.5 DVD onto vc5. Also download and install the relevant version of SQL Management Studio Express.</em></div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;"><em style="background-color: white; border: 0px; line-height: 18px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">4. On vc5, launch SQL Management Studio, create a "fictitious" vCenter database of the same name as the&nbsp; VC 4.1 database, right-click it and restore the backup.</em></div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;"><em style="background-color: white; border: 0px; line-height: 18px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">5. On vc5, create a 64-bit ODBC DSN using the SQL Native Client v10 driver pointing to the restored vCenter database that's still in "vCenter 4.1 format". Ensure ODBC connectivity tests are successful.</em></div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;"><em style="background-color: white; border: 0px; line-height: 18px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">6. If the Windows OS version on vc5 and vc4 are the same, the ADAM database must also be migrated to vc5 by first backing it up as follows:-</em></div><ol style="border: 0px; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; line-height: 21px; margin: 0px; orphans: 2; outline: 0px; padding: 0px 0px 0px 30px; vertical-align: baseline; widows: 2;"><li style="border: 0px; font-family: inherit; font-style: inherit; list-style: inherit; margin: 0.5ex 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><em style="background-color: white; border: 0px; line-height: 18px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Click&nbsp;<strong style="border: 0px none; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Start</strong>, right-click&nbsp;<strong style="border: 0px none; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Command Prompt</strong>, then click&nbsp;<strong style="border: 0px none; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Run as administrator&nbsp;</strong>to open a command prompt.</em></li><li style="border: 0px; font-family: inherit; font-style: inherit; list-style: inherit; margin: 0.5ex 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><em style="background-color: white; border: 0px; line-height: 18px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Run the command: dsdbutil</em></li><li style="border: 0px; font-family: inherit; font-style: inherit; list-style: inherit; margin: 0.5ex 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><em style="background-color: white; border: 0px; line-height: 18px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">At the dsdbutil: prompt, run the command: activate instance VMwareVCMSDS</em></li><li style="border: 0px; font-family: inherit; font-style: inherit; list-style: inherit; margin: 0.5ex 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><em style="background-color: white; border: 0px; line-height: 18px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Run this command to open the ifm prompt: ifm</em></li><li style="border: 0px; font-family: inherit; font-style: inherit; list-style: inherit; margin: 0.5ex 0px; outline: 0px; padding: 0px; vertical-align: baseline;"><em style="background-color: white; border: 0px; line-height: 18px; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">At the ifm: prompt, run this command for the type of installation media that you want to create: create full&nbsp;<em style="border: 0px none; font-family: inherit; font-size: inherit; font-variant: inherit; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">location</em></em></li></ol><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;"><span style="border: 0px none; font-family: inherit; font-size: inherit !important; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px 0px 0px 60px; outline: 0px; padding: 0px; vertical-align: baseline;">For example: create full C:\Backup\VMwareVCMSDS</span></div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;"><span style="border: 0px none; font-family: inherit; font-size: inherit !important; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px 0px 0px 60px; outline: 0px; padding: 0px; vertical-align: baseline;">You see output similar to:<br />ifm: create full C:\Backup\VMwareVCMSDS Creating snapshot... Snapshot set {93758b0e-0b5f-4969-a3ae-c3672b659e08} generated successfully. Snapshot {d3257ca1-cb91-4535-82c0-8aa38bc0b566} mounted as C:\$SNAP_201010251019 _VOLUMEC$\ Initiating DEFRAGMENTATION mode... Source Database: C:\$SNAP_201010251019_VOLUMEC$\Program Files\VMware\Infras tructure\VirtualCenter Server\VMwareVCMSDS\adamntds.dit Target Database: c:\Backup\VMwareVCMSDS\adamntds.dit</span></div><blockquote style="background-image: url(https://communities.vmware.com/5.0.5/images/quote-background-1.gif); background-repeat: repeat; border-color: rgb(238, 238, 238) rgb(238, 238, 238) rgb(238, 238, 238) rgb(204, 204, 204); border-style: solid; border-width: 1px 1px 1px 2px; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; line-height: 21px; margin: 10px 20px; orphans: 2; outline: 0px; overflow: auto; padding: 10px; vertical-align: baseline; widows: 2;"><blockquote style="background-image: url(https://communities.vmware.com/5.0.5/images/quote-background-2.gif); background-repeat: repeat repeat; border-bottom-color: rgb(238, 238, 255); border-bottom-style: solid; border-bottom-width: 1px; border-left-color: rgb(204, 204, 255); border-left-style: solid; border-left-width: 2px; border-right-color: rgb(238, 238, 255); border-right-style: solid; border-right-width: 1px; border-top-color: rgb(238, 238, 255); border-top-style: solid; border-top-width: 1px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 10px 20px; outline: 0px; overflow: auto; padding: 10px; vertical-align: baseline;">Defragmentation Status (% complete)0 1020 30 40 50 60 70 80 90 100|----|----|----|----|----|----|----|----|----|----|...................................................Snapshot {d3257ca1-cb91-4535-82c0-8aa38bc0b566} unmounted.IFM media created successfully in C:\Backup\VMwareVCMSDS</blockquote></blockquote><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">&nbsp;&nbsp;&nbsp;&nbsp; 6. Exit dsdbutil:</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">&nbsp;&nbsp;&nbsp;&nbsp; 7.At the ifm: prompt, type quit, then press Enter.</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">&nbsp;&nbsp;&nbsp;&nbsp; 8. At the dsdbutil: prompt, type quit, then press Enter.</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; height: 8pt; margin: 2px; min-height: 8pt; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;"><br /></div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">7. On vc5, stop and restart the vCenter SQL Database service, then insert the vCenter 5.5 DVD and get it to do a fresh install.&nbsp;<strong style="border: 0px none; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Do not select the Simple Install option. Install each component one at a time.&nbsp;</strong>When the vCenter Server component installation gets to the database part, you tell it to use the DSN created in step 5 and it will detect that it's a vCenter 4.1 database and prompt you to upgrade it.</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">8. If the Windows OS version on vc5 and vc4 are the same, the ADAM database must be restored as follows:-</div><ol style="border: 0px; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; line-height: 21px; margin: 0px; orphans: 2; outline: 0px; padding: 0px 0px 0px 30px; vertical-align: baseline; widows: 2;"><li style="border: 0px; font-family: inherit; font-style: inherit; list-style: inherit; margin: 0.5ex 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Stop these services in this order<br />VMware VirtualCenter Management Webservices<br />VMware VirtualCenter Server<br />VMwareVCMSDS</li><li style="border: 0px; font-family: inherit; font-style: inherit; list-style: inherit; margin: 0.5ex 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Backup the files in the folder that contains the instance data files to an alternate location. By default, the database and log files are located at %ProgramFiles%\VMware\Infrastructure\VirtualCenter Server\VMwareVCMSDS.<br /><strong style="border: 0px none; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Note</strong>: In Windows 2008/2008 R2, the default path is: C:\%ProgramData%\VMware\VMware VirtualCenter\VMwareVCMSDS.</li></ol><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">&nbsp;&nbsp;&nbsp;&nbsp; 3. Run this command to copy the ADAM backup that was created using dsdbutil.exe in step 6 to the folder that contained the original ADAM database and log files:</div><blockquote style="background-image: url(https://communities.vmware.com/5.0.5/images/quote-background-1.gif); background-repeat: repeat; border-color: rgb(238, 238, 238) rgb(238, 238, 238) rgb(238, 238, 238) rgb(204, 204, 204); border-style: solid; border-width: 1px 1px 1px 2px; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; line-height: 21px; margin: 10px 20px; orphans: 2; outline: 0px; overflow: auto; padding: 10px; vertical-align: baseline; widows: 2;"><div style="border: 0px none; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: 18px; margin: 2px; outline: 0px; padding: 0px; vertical-align: baseline;"><strong style="border: 0px none; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">Note</strong>: In vSphere 5.1 and vSphere 5.5, the VMwareVCMSDS folder is located:<br />xcopy /os b<em style="border: 0px none; font-family: inherit; font-size: inherit; font-variant: inherit; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">ackup_location</em>\adamntds.dit "%ProgramData%\VMware\VMware VirtualCenter\VMwareVCMSDS"</div><div style="border: 0px none; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: 18px; margin: 2px; outline: 0px; padding: 0px; vertical-align: baseline;">Where backup_<em style="border: 0px none; font-family: inherit; font-size: inherit; font-variant: inherit; line-height: inherit; margin: 0px; outline: 0px; padding: 0px; vertical-align: baseline;">location</em>&nbsp;is the folder path within which the ADAM database was backed up. For example:<br />xcopy /os C:\Backup\VMwareVCMSDS\adamntds.dit "c:\Program Files\VMware\Infrastructure\VirtualCenter Server\VMwareVCMSDS"</div></blockquote><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">&nbsp;&nbsp;&nbsp;&nbsp; 4. Start these services in this order:</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VMware VirtualCenter Server</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VMwareVCMSDS</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VMware VirtualCenter Management Webservices</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; height: 8pt; margin: 2px; min-height: 8pt; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;"><br /></div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">9. Check the /etc/hosts files on the ESXi servers and remove any references to vc4 if they exist. Check that the ESXi servers can ping vc5 by name and IP.</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">10. Using the vSphere 5.5 client, login to vCenter on vc5 as&nbsp;<a href="mailto:Administrator@vsphere.local." style="background-image: url(https://communities.vmware.com/5.0.5/images/jive-icon-email-12x12.png); background-position: 0% 50%; background-repeat: no-repeat; border: 0px none; color: #3399cc; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; line-height: inherit; margin: 0px; outline: 0px; padding: 1px 0px 1px 17px; text-decoration: none; vertical-align: baseline; zoom: 1;">Administrator@vsphere.local.</a>&nbsp;Re-connect the ESXi hosts and monitor that the new vCenter agents and HA agents get installed successfully.</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">11. Goto vCenter Server Settings and select Runtime Settings. Replace the hostname of vc4 with vc5 and put vc5's IP address as the Managed Server.</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">12. Still in vCenter Server Settings, select Advanced Settings and carefully change all URL entries to point to the new vc5 server's name.</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">13. Reboot vc5. Login to vCenter using the vSphere Client and from the Home screen, select vCenter Service Status. Check that all services have big green ticks. If there are any red crosses:-</div><div style="border: 0px none; color: #666666; font-family: proxima-nova, Arial, sans-serif; font-size: 14px; margin: 2px; orphans: 2; outline: 0px; padding: 0px; vertical-align: baseline; widows: 2;">Follow the instructions in VMware KB 2006132 and NOTE in step 6, replace "cleanup.bat com.vmware.converter" with "cleanup.bat com.vmware.xxxxx", where xxxxx is the name of the service with the red cross.</div></div></div>