---
layout: post
title: Comparing memory reclamation techniques in existing hypervisors
date: '2014-07-24T01:37:00.000-07:00'
author: Girish Rao
tags:
- misc
- esxi
modified_time: '2014-10-11T23:47:35.389-07:00'
blogger_id: tag:blogger.com,1999:blog-984868599755994151.post-7171040917535152195
blogger_orig_url: http://www.virtualtipsntricks.com/2014/07/comparing-memory-reclamation-techniques.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">Different hypervisors do things differntly. In this post, we take a look at some of the memory reclamation techniques employed by the most popular hypervisors today.<br /><br />The below table sums things up nicely:<br /><br /><table border="1" cellpadding="0" cellspacing="0" style="background-color: white; border-collapse: collapse; border-spacing: 0px; color: #444444; font-family: 'Merriweather Sans', sans-serif; font-size: 15px; line-height: 21.011201858520508px; margin: 0px 0px 20px; width: 690px;"><tbody><tr><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="100">METHOD</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54">ESX(i)</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="59">HYPER-V</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54">KVM</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="63">XEN</td></tr><tr><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="100">Transparent page sharing</td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54">Y</td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="59"></td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54">Y</td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="63"></td></tr><tr><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="100">Memory Ballooning</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54">Y</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="59">Y</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54">Y</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="63">Y</td></tr><tr><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="100">Compress</td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54">Y</td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="59"></td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54"></td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="63"></td></tr><tr><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="100">Swapping</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54">Y</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="59">Y</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54">Y</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="63"></td></tr><tr><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="100">Memory hot-add</td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54"></td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="59">Y</td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54"></td><td style="border: 1px solid rgb(221, 221, 221); padding: 10px;" width="63"></td></tr><tr><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="100">Transcendent memory</td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54"></td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="59"></td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="54"></td><td style="background: rgb(249, 249, 249); border: 1px solid rgb(221, 221, 221); padding: 10px;" width="63">Y</td></tr></tbody></table><br /><div><div class="titlepage" style="background-color: white; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><h4 class="title" style="clear: both; color: #bd1d1d; font-size: 1.2em; margin: 0px 0px 6px; padding: 0px;">Transparent page sharing</h4></div></div></div><div style="background-color: white; clear: both; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin-bottom: 6px; margin-left: -40px; padding: 0px 0px 0px 40px; z-index: 100;">When there are&nbsp;multiple virtual machines&nbsp;running on the same hypervisor, most of the time some of them might have identical sets of memory content (known as memory pages). These pages can be shared across these VMs.</div><div style="background-color: white; clear: both; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin-bottom: 6px; margin-left: -40px; padding: 0px 0px 0px 40px; z-index: 100;"><br /></div><div class="titlepage" style="background-color: white; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><h4 class="title" style="clear: both; color: #bd1d1d; font-size: 1.2em; margin: 0px 0px 6px; padding: 0px;">Memory ballooning</h4></div></div></div><div style="background-color: white; clear: both; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin-bottom: 6px; margin-left: -40px; padding: 0px 0px 0px 40px; z-index: 100;">Memory ballooning&nbsp;makes the guest operating system aware that it does not have&nbsp;enough memory from the host, so that the guest operating system frees some of its memory. This is done via a balloon driver. &nbsp;When there is a memory crisis, hypervisor tells the balloon driver to request some memory from the guest operating system. The hypervisor knows that pages occupied by the balloon driver will never store data, so the pages of RAM backing the balloon driver can then be reallocated safely to other VMs</div><div class="titlepage" style="background-color: white; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><h4 class="title" style="clear: both; color: #bd1d1d; font-size: 1.2em; margin: 0px 0px 6px; padding: 0px;">Memory compression</h4></div></div></div><div style="background-color: white; clear: both; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin-bottom: 6px; margin-left: -40px; padding: 0px 0px 0px 40px; z-index: 100;">Pages are compressed and stored in a cache on the main memory itself. These pages can be accessed again just by a decompression rather than through disk I/O in the case of page swapping which can significantly improve application performance when the host is under memory pressure. If a page cannot be compressed, it will be swapped out.</div><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span><br /><div class="titlepage" style="background-color: white; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><h4 class="title" style="clear: both; color: #bd1d1d; font-size: 1.2em; margin: 0px 0px 6px; padding: 0px;">Swapping</h4></div></div></div><div style="background-color: white; clear: both; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin-bottom: 6px; margin-left: -40px; padding: 0px 0px 0px 40px; z-index: 100;">This is generally used as a last resort to reclaim memory. In this technique, the hypervisor creates a separate swap file for each virtual machine when it is powered on and swaps out guest physical memory thus freeing up host memory.</div><div class="titlepage" style="background-color: white; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><h4 class="title" style="clear: both; color: #bd1d1d; font-size: 1.2em; margin: 0px 0px 6px; padding: 0px;"> Memory Hot-Add(Dynamic Memory)</h4></div></div></div><div style="background-color: white; clear: both; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin-bottom: 6px; margin-left: -40px; padding: 0px 0px 0px 40px; z-index: 100;">Each VM is configured with a small initial RAM when powered on. When the guest applications require more memory, a certain amount of memory will be hot-added to the VM and the guest OS. Ballooning is used to reclaim memory not being used.<br /><div><div><span style="font-family: Arial, Helvetica, sans-serif; font-size: x-small;"><br /></span></div><div class="titlepage" style="background-color: white; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><div style="margin: 0px; padding: 0px;"><h4 class="title" style="clear: both; color: #bd1d1d; font-size: 1.2em; margin: 0px 0px 6px; padding: 0px;">Transcendent&nbsp;memory</h4></div></div></div><div style="background-color: white; clear: both; font-family: Arial, Helvetica, sans-serif; font-size: 12px; margin-bottom: 6px; margin-left: -40px; padding: 0px 0px 0px 40px; z-index: 100;">The idle memory is collected into a pool and distributed based on the demand of running VMs.&nbsp;This approach requires the guest OS to be paravirtualized.</div></div></div></div></div>