<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>HOW TO BACKUP AND RESTORE THE VMWARE DIRECTORY SERVICES (VMDIR) DATABASE &vert; VIRTUALTIPSNTRICKS</title>
<meta name="description" content="vTips For Programmers">
<meta name="keywords" content="vcenter, SSO">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/logo.png">
<meta name="twitter:title" content="How to Backup and Restore the VMware Directory Services (vmdir) database">
<meta name="twitter:description" content="vTips For Programmers">
<meta name="twitter:creator" content="@rrgirish">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="How to Backup and Restore the VMware Directory Services (vmdir) database">
<meta property="og:description" content="vTips For Programmers">
<meta property="og:url" content="/how-to-backup-and-restore-vmware">
<meta property="og:site_name" content="VirtualTipsnTricks">
<meta property="og:image" content="/images/intro-bg.jpg">





<link rel="canonical" href="/how-to-backup-and-restore-vmware">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="VirtualTipsnTricks Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />


    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400,600,300,800,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/assets/css/vendor/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/vendor/normalize.css">
    <link rel="stylesheet" href="/assets/css/vendor/nprogress.css">
    <link rel="stylesheet" href="/assets/css/vendor/foundation.min.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/post.css">





<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

<style type="text/css">@media only screen and (min-width:43.75em){.notepad-post-content div>p:first-child:first-letter{float:left;font-size:4.688rem;line-height:4.375rem;padding-top:.25rem;padding-right:.5rem;padding-left:.188rem;font-family:serif}}</style>
</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">

        <main id="notepad-post-container-simple" class="notepad-post-container-simple" role="main">
            <header class="notepad-post-header-simple">
                <div class="notepad-post-menu-header-simple">

                    <a class="notepad-blog-logo" href="">
                        <img src="/images/logo.png" alt="Blog Logo" />
                    </a>

                <div class="notepad-blog-menu">
    <div class="notepad-mobile-menu show-for-small">
        <a href="#"><i class="fa fa-bars"></i></a>
    </div>
    <ul class="notepad-menu">
        <li class="notepad-mobile-close-btn show-for-small text-right">
            <a href="#"><i class="fa fa-times"></i></a>
        </li>

            <li>
                    <a href="/">Home</a>
                 </li>

            <li>
                    <a href="/featured">Featured Posts</a>
                 </li>

            <li>
                    <a href="/categories">Categories</a>
                 </li>

            <li>
                    <a href="/about">About</a>
                 </li>

           <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </ul>

</div>
            </div>

                <div class="notepad-post-title-simple row">
                    <div class="small-12 columns">
                        <div class="notepad-post-meta-simple">
                            <h1>How to Backup and Restore the VMware Directory Services (vmdir) database</h1>
                            <p>by <strong>Girish Rao</strong> &#8212; on <a href="/tags/index.html#vcenter" data-toggle="tooltip" title="Posts tagged with vcenter" rel="tag">vcenter</a>&nbsp;&comma;&nbsp;<a href="/tags/index.html#SSO" data-toggle="tooltip" title="Posts tagged with SSO" rel="tag">SSO</a> <strong><time datetime="2014-11-05T18:08:00+06:00">05 Nov 2014</time></strong></p>
                        </div>
                    </div>
                </div>
            </header>

        <article class="notepad-post-content post tag-simple">
            <div><div dir="ltr" style="text-align: left;" trbidi="on"><script src="http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shCore.js" type="text/javascript"></script><script src="http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shBrushRuby.js" type="text/javascript"></script><script src="http://alexgorbatchev.com/pub/sh/2.1.364/scripts/shLegacy.js" type="text/javascript"></script><link href="http://alexgorbatchev.com/pub/sh/2.1.364/styles/shCore.css" rel="stylesheet" type="text/css"></link><link href="http://alexgorbatchev.com/pub/sh/2.1.364/styles/shThemeDefault.css" rel="stylesheet" type="text/css"></link><script language="javascript"><br />window.onload = function () {<br />    dp.SyntaxHighlighter.ClipboardSwf = 'http://alexgorbatchev.com/pub/sh/2.1.364/scripts/clipboard.swf';<br />    dp.SyntaxHighlighter.HighlightAll('code');<br />    dp.SyntaxHighlighter.BloggerMode();<br />}<br /></script> <br /><br />Ever wondered how to backup the SSO “Database” in vSphere 5.5? Read on!<br /><h4>Backup VMDIR</h4>You can use the vdcbackup utility to facilitate this task. vdcbackup is located by default in the vmdir installation folder (C:\Program Files\VMware\Infrastructure\VMware\CIS\vmdir) or (/usr/lib/vmware-vmdir/bin).<br />It is executed by running the command with a path to the database, followed by a path to the target location. This command should be run with administrator privileges.<br />Windows Example:<br /><blockquote><div class="syntaxhighlighter  ruby" id="highlighter_400117"><div class="bar"><div class="toolbar"><a class="item viewSource" commandname="viewSource" highlighterid="highlighter_400117" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#viewSource" style="height: 16px; width: 16px;" title="view source">view source</a><a class="item printSource" commandname="printSource" highlighterid="highlighter_400117" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#printSource" style="height: 16px; width: 16px;" title="print">print</a><a class="item about" commandname="about" highlighterid="highlighter_400117" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#about" style="height: 16px; width: 16px;" title="?">?</a></div></div><div class="lines"><div class="line alt1"><table> <tbody><tr> <td class="number"><code>1</code></td> <td class="content"><code class="ruby constants">C</code><code class="ruby plain">:\&gt; mkdir c:\vmdirbackup\</code><code class="ruby constants">C</code><code class="ruby plain">:\&gt; cd </code><code class="ruby string">"C:\Program Files\VMware\Infrastructure\VMware\CIS\vmdird"</code><code class="ruby constants">C</code><code class="ruby plain">:\...\vmdird&gt; vdcbackup.exe&nbsp; C:\ProgramData\VMware\</code><code class="ruby constants">CIS</code><code class="ruby plain">\data\vmdird\ c:\vmdirbackup\ </code></td></tr></tbody></table></div></div></div></blockquote><pre></pre><br />VCSA Example:<br /><br /><div class="syntaxhighlighter  ruby" id="highlighter_774809"><div class="bar                                "><div class="toolbar"><a class="item viewSource" commandname="viewSource" highlighterid="highlighter_774809" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#viewSource" style="height: 16px; width: 16px;" title="view source">view source</a><a class="item printSource" commandname="printSource" highlighterid="highlighter_774809" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#printSource" style="height: 16px; width: 16px;" title="print">print</a><a class="item about" commandname="about" highlighterid="highlighter_774809" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#about" style="height: 16px; width: 16px;" title="?">?</a></div></div><br /><div class="lines"><div class="line alt2"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="ruby comments"># mkdir /vmdirbackup/</code># /usr/lib/vmware-vmdir/bin/vdcbackup /storage/db/vmware-vmdir /vmdirbackup/</td></tr></tbody></table></div></div></div><br />Note: This tool essentially does the following:<br />1. Marks the vmdir service as READ ONLY<br />2. Then uses a standard DOS or Linux “copy” commands to copy data.mdb, and lock.mdb into the destination location.<br />3. Returns the vmdir service to READ/WRITE status.<br /><br /><strong>vTip: The target folder must exist prior to using this utility, and also you should ensure the trailing appropriate slash is present. Failure to do both of these things will result in an invalid backup.</strong> <br /><br /><h4>Restoring VMDIR</h4><br />Use the “restore” feature in vmdird.exe to restore a backed up database should the need arise. <br /><br />In order to restore a previously backed up copy of the vmdir database:<br />1. Stop the VMware Directory Services service.<br />2. Copy the backup DB files (data.mdb, lock.mdb) to the VMware Directory Services folder<br />3. Start vmdir in restore mode: <br /><br /><div class="syntaxhighlighter  ruby" id="highlighter_303407"><br /><div class="bar                   "><br /><div class="toolbar"><a class="item viewSource" commandname="viewSource" highlighterid="highlighter_303407" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#viewSource" style="height: 16px; width: 16px;" title="view source">view source</a><a class="item printSource" commandname="printSource" highlighterid="highlighter_303407" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#printSource" style="height: 16px; width: 16px;" title="print">print</a><a class="item about" commandname="about" highlighterid="highlighter_303407" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#about" style="height: 16px; width: 16px;" title="?">?</a></div></div><br /><div class="lines"><br /><div class="line alt2"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="ruby plain">vmdird –c –m restore</code></td></tr></tbody></table></div></div></div><br />4. Optionally: start vmdir in standalone mode to review the data. <br /><br /><div class="syntaxhighlighter  ruby" id="highlighter_435554"><br /><div class="bar             "><br /><div class="toolbar"><a class="item viewSource" commandname="viewSource" highlighterid="highlighter_435554" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#viewSource" style="height: 16px; width: 16px;" title="view source">view source</a><a class="item printSource" commandname="printSource" highlighterid="highlighter_435554" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#printSource" style="height: 16px; width: 16px;" title="print">print</a><a class="item about" commandname="about" highlighterid="highlighter_435554" href="https://www.blogger.com/blogger.g?blogID=984868599755994151#about" style="height: 16px; width: 16px;" title="?">?</a></div></div><br /><div class="lines"><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="ruby plain">vmdird –m standalone</code></td></tr></tbody></table></div></div></div><br />5. Start the VMware Directory Services service normally.<br /><br /><strong>vTip: Make sure to start the vmdir service in standalone mode afterwards, otherwise you risk bad data being replicated to other nodes.</strong><br /><br /><strong>vTip: This vmdir database contains hostname elements. Do not use this backup/restore method to migrate the SSO database to a new machine.</strong></div>
            </div>
        </article>
        <div class="cf"></div>
        <div class="row text-center">
            <section class="notepad-post-share">
                <a class="twitter-icon" href="https://twitter.com/intent/tweet?text=&quot;How to Backup and Restore the VMware Directory Services (vmdir) database&quot;%20/how-to-backup-and-restore-vmware%20via%20&#64;rrgirish"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="facebook-icon" href="https://www.facebook.com/sharer/sharer.php?u=/how-to-backup-and-restore-vmware"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="google-icon" href="https://plus.google.com/share?url=/how-to-backup-and-restore-vmware"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
            </section>
        </div>
        <div class="cf"></div>

            <div class="notepad-author-info">
                <div class="row">
                    <section class="notepad-post-author small-12 columns">
                        
                            <img src="/images/rrgirish.jpg" class="notepad-post-author-avatar" alt="Girish Rao's photo">
                        
                        
                            <span class="author-label">Author</span>
                            <h1>Girish Rao</h1>
                        
                        
                            <p><a href="mailto:grao@usc.edu" class="author-website">grao@usc.edu</a></p>
                        
                        
                            <p>vTips for Programmers!</p>
                        
                    </section>
                </div>
            </div>

        <div class="cf"></div>
        
        <div class="cf"></div>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Side Ad -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6560934940333129"
     data-ad-slot="3568443695"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

    <footer class="notepad-site-footer">
    <div class="copyright">
         <section>All content copyright <a href="/about">Girish Rao</a> &copy; 2016 &bull; All rights reserved.</section>
         <section>Proudly published with <a class="icon-ghost" href="https://jekyllrb.com/">Jekyll</a></section>
    </div>
    <div class="social-icons">

        
        <a href="http://twitter.com/rrgirish">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
            </span>
        </a>
        
        
        
        <a href="https://linkedin.com/in/girishramchandrarao">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-linkedin fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://github.com/rrgirish">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-github fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://facebook.com/rrgirish">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-facebook fa-stack-1x"></i>
            </span>
        </a>
        
    </div>

    <div class="cf"></div>
</footer>

</main>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>
    <script src="/assets/js/vendor/modernizr.js"></script>
    <script src="/assets/js/foundation.min.js"></script>
    
    <script src="/assets/js/notepad.js"></script>
    <script src="/assets/js/scripts.min.js"></script>
    <script src="/assets/js/vendor/nprogress.js"></script>

    <script>
      $(document).foundation();
    </script>
    <script type='text/javascript'>console.log("HMFaysal Notepad Theme Version 2.0");</script>
    <script type='text/javascript'>console.log("https://alum.mit.edu/www/hmfaysal");</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-74122796-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>

<script>NProgress.start();var interval=setInterval(function(){NProgress.inc()},1000);jQuery(window).load(function(){clearInterval(interval);NProgress.done()});jQuery(window).unload(function(){NProgress.start()});</script>

</body>
</html>
